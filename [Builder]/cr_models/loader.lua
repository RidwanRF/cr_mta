VEHICLES_LIST = {
	[480] = {"480.staymodel", 1696, 7481595, 2685680, 0},
	[357] = {"357.staymodel", 1586, 172032, 268288, 0},
	[492] = {"492.staymodel", 1874, 4223897, 1617448, 0},
	[405] = {"405.staymodel", 1907, 5713358, 3335080, 0},
	[409] = {"409.staymodel", 1186, 3721216, 2235432, 0},
	[413] = {"413.staymodel", 1045, 930516, 886568, 0},
	[429] = {"429.staymodel", 890, 2519040, 2381320, 0},
	[3893] = {"3893.staymodel", 1925, 1775, 524456, 120},
	[322] = {"322.staymodel", 854, 11659, 160696, 0},
	[521] = {"521.staymodel", 530, 3293184, 1161256, 0},
	[461] = {"461.staymodel", 652, 811783, 1132968, 0},
	[477] = {"477.staymodel", 1805, 4105856, 4228776, 0},
	[585] = {"585.staymodel", 1660, 5369856, 716328, 0},
	[522] = {"522.staymodel", 1406, 2127872, 6366552, 0},
	[3898] = {"3898.staymodel", 691, 596629, 1051688, 16672},
	[578] = {"578.staymodel", 838, 2330624, 1680680, 0},
	[586] = {"586.staymodel", 1523, 4345856, 1002600, 0},
	[426] = {"426.staymodel", 1743, 2340864, 566568, 0},
	[602] = {"602.staymodel", 1903, 4298856, 2265832, 0},
	[10012] = {"10012.staymodel", 1814, 188174, 198056, 0},
	[438] = {"438.staymodel", 1223, 4319232, 1189888, 0},
	[323] = {"323.staymodel", 1624, 9183, 213352, 0},
	[462] = {"462.staymodel", 1817, 2414232, 351400, 0},
	[339] = {"339.staymodel", 1457, 97931, 278824, 0},
	[470] = {"470.staymodel", 1007, 2717696, 2761768, 0},
	[347] = {"347.staymodel", 1154, 17468, 373288, 0},
	[351] = {"351.staymodel", 1811, 404001, 540968, 0},
	[482] = {"482.staymodel", 1799, 5598505, 5413288, 0},
	[494] = {"494.staymodel", 740, 5677056, 5580584, 0},
	[506] = {"506.staymodel", 1765, 4784331, 756392, 0},
	[516] = {"516.staymodel", 1674, 7970308, 546232, 0},
	[411] = {"411.staymodel", 2019, 3673777, 4252072, 0},
	[415] = {"415.staymodel", 1739, 4831232, 1300136, 0},
	[580] = {"580.staymodel", 884, 6115328, 3532096, 0},
	[596] = {"596.staymodel", 1562, 2588672, 6023592, 0},
	[604] = {"604.staymodel", 1455, 1529856, 575400, 0},
	[439] = {"439.staymodel", 1523, 1368064, 588968, 0},
	[17426] = {"17426.staymodel", 1452, 44456, 147752, 0},
	[451] = {"451.staymodel", 1630, 4840179, 1169576, 0},
	[525] = {"525.staymodel", 834, 1703936, 522152, 0},
	[541] = {"541.staymodel", 1037, 5064704, 766792, 0},
	[467] = {"467.staymodel", 814, 4343808, 2054656, 0},
	[348] = {"348.staymodel", 1366, 67548, 279976, 0},
	[479] = {"479.staymodel", 1041, 3379200, 1212968, 0},
	[581] = {"581.staymodel", 1846, 5605376, 2112688, 0},
	[597] = {"597.staymodel", 833, 5902336, 3359384, 0},
	[605] = {"605.staymodel", 780, 4233216, 2918952, 0},
	[372] = {"372.staymodel", 596, 325632, 280104, 0},
	[503] = {"503.staymodel", 1422, 2215936, 3434280, 0},
	[358] = {"358.staymodel", 1045, 708281, 2364968, 0},
	[350] = {"350.staymodel", 1080, 214391, 148904, 0},
	[542] = {"542.staymodel", 1105, 4001792, 2935208, 0},
	[334] = {"334.staymodel", 2020, 51200, 51200, 0},
	[353] = {"353.staymodel", 1337, 39722, 9384, 0},
	[352] = {"352.staymodel", 543, 126321, 542120, 0},
	[356] = {"356.staymodel", 1645, 260522, 529832, 0},
	[335] = {"335.staymodel", 1915, 143108, 528680, 0},
	[400] = {"400.staymodel", 1614, 5341184, 2906408, 0},
	[598] = {"598.staymodel", 973, 5580800, 6242856, 0},
	[355] = {"355.staymodel", 1443, 288940, 131240, 0},
	[436] = {"436.staymodel", 1240, 4886528, 2337576, 0},
	[3891] = {"3891.staymodel", 885, 13594, 262440, 2204},
	[3892] = {"3892.staymodel", 1476, 1175, 524456, 120},
	[3895] = {"3895.staymodel", 1984, 1191190, 1052456, 35600},
	[468] = {"468.staymodel", 1739, 3092480, 1123624, 0},
	[463] = {"463.staymodel", 1070, 6766592, 1327104, 0},
	[491] = {"491.staymodel", 1218, 1329152, 1966504, 0},
	[543] = {"543.staymodel", 769, 2989552, 1812016, 0},
	[551] = {"551.staymodel", 1127, 5689344, 7828008, 0},
	[599] = {"599.staymodel", 1227, 475136, 222672, 0},
	[349] = {"349.staymodel", 1088, 144841, 202280, 0},
	[600] = {"600.staymodel", 1416, 6486016, 1203752, 0},
};

local loadFromRAM = true;

local function saveFile(path, data)
    if not path then
        return false;
    end

    if fileExists(path) then
        fileDelete(path);
    end

    local file = fileCreate(path);
    fileWrite(file, data);
    fileClose(file);

    return true
end

function loadModel(model, fileName, headerLength, dffLength, txdLength, colLenght)
	local file = fileOpen(fileName);
	if not file then
		return;
	end

	file.pos = headerLength;
	local dffData = file:read(dffLength);
	local txdData = file:read(txdLength);

	local colData = nil;
	if colLenght > 0 then
		colData = file:read(colLenght);
	end

	-- TXD
	local txd;
	if not loadFromRAM then
		txd = engineLoadTXD(txdData);
	else
		saveFile("tmp", txdData);
		txd = engineLoadTXD("tmp");			
	end
	if txd then		
		engineImportTXD(txd, model);
	end

	-- DFF
	local dff;
	if loadFromRAM then
		dff = engineLoadDFF(dffData);
	else
		saveFile("tmp", dffData);
		dff = engineLoadDFF("tmp");
	end

	if dff then
		engineReplaceModel(dff, model);
	end

	local col;
	if colData then
		if loadFromRAM then
			col = engineLoadCOL(colData);
		else
			saveFile("tmp", colData);
			col = engineLoadCOL("tmp");
		end

		if col then
			engineReplaceCOL(col, model);
			outputDebugString(model)
		end
	end

	if fileExists("tmp") then
		fileDelete("tmp");
	end

	file:close();
end

addEventHandler("onClientResourceStart", resourceRoot, function()
	if not VEHICLES_LIST then
		outputDebugString("cr_modpanel error: no VEHICLES_LIST")
		cancelEvent();
	end

	engineSetAsynchronousLoading(false, false);

	for i, info in ipairs(VEHICLES_LIST) do
		--loadModel(unpack(info));
	end
end)


